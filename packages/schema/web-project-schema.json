{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://growing-web.manifest/schema.json",
  "title": "Project Manifest",
  "description": "Project manifest field in growing-web.",
  "type": "object",
  "additionalProperties": false,
  "definitions": {
    "entries": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "publicPath": { "type": "string" },
    "sourcemap": { "type": "boolean" },
    "outDir": { "type": "string" },
    "externals": {
      "anyOf": [
        { "type": "array", "items": { "type": "string" } },
        {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "regular": { "type": "boolean" },
              "globalName": { "type": "string" }
            },
            "required": ["name"]
          }
        }
      ]
    },
    "server": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "port": { "type": "number", "minimum": 0, "maximum": 65535 },
        "host": { "type": "string" }
      }
    },
    "exports": {
      "type": "object",
      "patternProperties": {
        "^(cjs|esm|iife|umd|system|name|importmap)$": {
          "type": "string"
        }
      }
    },
    "formats": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["cjs", "esm", "iife", "umd", "system"]
      }
    },

    "pathRewrite": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "regular": {
            "anyOf": [{ "instanceof": "RegExp" }, { "type": "string" }]
          },
          "replacement": {
            "type": "string"
          }
        }
      }
    }
  },
  "properties": {
    "$schema": {
      "description": "schema remote path.",
      "type": "string"
    },
    "schemaVersion": {
      "description": "The version number of the manifest.",
      "type": "string"
    },
    "entries": {
      "$ref": "#/definitions/entries",
      "description": "application entries file."
    },
    "exports": {
      "$ref": "#/definitions/exports",
      "description": "application export description."
    },
    "publicPath": {
      "$ref": "#/definitions/publicPath",
      "description": "Build tools publicPath configuration."
    },
    "externals": {
      "$ref": "#/definitions/externals",
      "description": "Shared Dependencies & Common Dependencies."
    },
    "outDir": {
      "$ref": "#/definitions/outDir",
      "description": "Build product output directory."
    },
    "formats": {
      "$ref": "#/definitions/formats",
      "description": "build product formats."
    },
    "server": {
      "$ref": "#/definitions/server",
      "description": "local server configuration"
    },
    "sourcemap": {
      "$ref": "#/definitions/sourcemap",
      "description": "generate sourcemap"
    },
    "env": {
      "type": "object",
      "description": "env configuration for different environments.",
      "additionalProperties": false,
      "patternProperties": {
        "[a-zA-Z]+": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "entries": { "$ref": "#/definitions/entries" },
            "publicPath": { "$ref": "#/definitions/publicPath" },
            "externals": { "$ref": "#/definitions/externals" },
            "exports": { "$ref": "#/definitions/exports" },
            "outDir": { "$ref": "#/definitions/outDir" },
            "sourcemap": { "$ref": "#/definitions/sourcemap" },
            "formats": { "$ref": "#/definitions/formats" },
            "server": { "$ref": "#/definitions/server" }
          }
        }
      }
    }
  },
  "required": ["schemaVersion", "entries"]
}
